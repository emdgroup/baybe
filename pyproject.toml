[project]
name = "baybe"
description = "Bayesian Back End for Design of Experiments"
authors = [
    {name = "Martin Fitzner (Merck KGaA, Darmstadt, Germany)", email = "martin.fitzner@merckgroup.com"},
    {name = "Adrian Šošić (Merck Life Science KGaA, Darmstadt, Germany)", email = "adrian.sosic@merckgroup.com"},
    {name = "Alexander Hopp (Merck KGaA, Darmstadt, Germany)", email = "alexander.hopp@merckgroup.com"},
    {name = "Alex Lee (EMD Electronics, Tempe, Arizona, USA)", email = "alex.lee@emdgroup.com"},
]
readme = "README.md"
license = {text = "Apache-2.0"}
requires-python =">=3.8.6"
dependencies = [
    "attrs>=22.2.0",
    "botorch>=0.8.1",
    "cattrs>=23.2.0",
    "funcy>=1.17",
    "gpytorch>=1.9.1",
    "ngboost>=0.3.12",
    "numpy>=1.24.1",
    "pandas[pyarrow]>=1.4.2",
    "protobuf<=3.20.3",
    "scikit-learn>=1.1.1",
    "scikit-learn-extra>=0.3.0",
    "scipy>=1.10.1",
    "setuptools-scm>=7.1.0",
    "torch>=1.11.0",
    "baybe[telemetry]",
]
dynamic = ['version']

# DEV TOOLS NOTE: The versions of all dev tools should be consistent everywhere
# (pre-commit, environment.yml, requirements.txt, pyproject.toml, ...)

# AUDIT NOTE: The marked packages are secondary dependencies but their versions are
# set explicitly because the otherwise installed default versions have been flagged
# for vulnerabilities by pip-audit

[project.optional-dependencies]
chem = [
    "rdkit>=2022.3.4",
    "mordred>=1.2.0",
]

onnx = [
    "onnxruntime>=1.15.1",
    "skl2onnx>=1.15.0",
]

dev = [
    "baybe[chem]",
    "baybe[docs]",
    "baybe[examples]",
    "baybe[lint]",
    "baybe[onnx]",
    "baybe[simulation]",
    "baybe[telemetry]",
    "baybe[test]",
    "pip-audit>=2.5.5",
    "tox>=4.10.0",
]

docs = [
    "baybe[examples]",  # docs cannot be built without running examples
    "p2j>=1.3.2",
    "jupyter>=1.0.0",
    "myst-parser>=2.0.0",
    "sphinx>=7.1.1",
    "sphinx-autodoc-typehints>=1.24.0",
    "sphinx-rtd-theme>=1.3.0",
]

examples = [
    "baybe[chem]", # Required for some of the examples
    "baybe[onnx]", # Required for some of the examples
    "matplotlib>=3.7.3",
    "openpyxl>=3.0.9",
    "pillow>=10.0.1", # Necessary due to vulnerability
    "plotly>=5.10.0",
    "seaborn>=0.12.2",
    "streamlit>=1.20.0",
    "tornado>=6.3.3",  # see AUDIT NOTE, required by streamlit
]

lint = [
    "black==22.3.0",  # see DEV TOOLS NOTE
    "flake8==4.0.1",  # see DEV TOOLS NOTE
    "flake8-docstrings==1.7.0", # see DEV TOOLS NOTE
    "mypy>=1.2.0",
    "pre-commit==2.19.0",  # see DEV TOOLS NOTE
    "pydoclint==0.2.1", # see DEV TOOLS NOTE
    "pylint==2.17.2",  # see DEV TOOLS NOTE
    "ufmt==1.3.2",  # see DEV TOOLS NOTE
    "usort==1.0.2",  # see DEV TOOLS NOTE
]

simulation = [
    "xyzpy>=1.2.1",
]

telemetry = [
    "opentelemetry-sdk>=1.16.0",
    "opentelemetry-propagator-aws-xray>=1.0.0",
    "opentelemetry-exporter-otlp>=1.16.0",
    "opentelemetry-sdk-extension-aws>=2.0.0",
    "requests>=2.31.0",  # see AUDIT NOTE
    "urllib3>=2.0.7",  # see AUDIT NOTE
]

test = [
    "pytest>=7.2.0",
    "pytest-cov>=4.1.0",
]

[build-system]
requires = [
    "setuptools>=45",
	"setuptools_scm[toml]>=6.2"
]
build-backend = "setuptools.build_meta"

[tool.setuptools_scm]
version_scheme = 'post-release'
local_scheme = "dirty-tag"

[tool.setuptools]
packages = ["baybe"]

[tool.black]
line-length = 88

[tool.pylint.TYPECHECK]
# List of members which are set dynamically and missed by pylint inference
# system, and so shouldn't trigger E1101 when accessed. Python regular
# expressions are accepted.
generated-members = "torch.*"

[tool.pylint.MASTER]
ignore-paths = "docs/*"

[tool.pylint.'MESSAGES CONTROL']
disable = [
    "broad-except",  # catching base exception is common for RDKit mol validation etc
    "duplicate-code",  # duplicate code happens eg in similar debug scripts
    "cyclic-import",  # seems like it commonly produces false positives
	"fixme",  # fixme hints should be allowed
	"too-many-instance-attributes",  # BayBE class has quite a few members
	"too-many-branches",  # can maybe be optimized later
    "too-few-public-methods",  # too strict, this happens in several places
	"no-member",  # seems RDKit objects in some modules can never be found by IDEs
    "no-name-in-module",  # seems RDKit objects in some modules can never be found by IDEs
    "too-many-arguments",  # too strict (encountered in history module)
    "too-many-locals",  # too strict (encountered in history module)
	"too-many-nested-blocks",  # too strict (encountered in history module)
	"too-many-statements",  # too strict (encountered in history module)
	"unsubscriptable-object",  # well known false positive
	# -> see https://github.com/PyCQA/pylint/issues/1498
    "wrong-import-order",  # handled by ufmt
    "import-error",  # otherwise linting can only succeed in full dev environment
	]
no-docstring-rgx = "__.*__"

[tool.pylint.BASIC]
good-names=["i", "j", "k", "x", "y", "ex", "df", "fh"] # allow these variable names

[tool.mypy]
files = [
    "baybe/core.py",
    "baybe/parameters.py",
    "baybe/searchspace.py",
]

[[tool.mypy.overrides]]
module = 'scipy.spatial.distance'
ignore_missing_imports = true

# TODO[12327]: Find a way to automatically install all mypy stubs during the
#   installation, to avoid having to call "mypy --install-types" afterwards.

[tool.usort]
first_party = ["baybe"]
